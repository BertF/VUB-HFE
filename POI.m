function [ x,y ] = POI( C, R, C2, R2, mode )
%INTERSECT Summary of this function goes here
%   Detailed explanation goes here
if nargin < 5
    mode = 'circle';
end;
if strcmpi(mode,'line')
    x= 0; y=0;
else % circles
    [x,y] = circ2(real(C),imag(C),R,real(C2),imag(C2),R2);
end;

function [x, y] = circ2(c1x, c1y, r1, c2x, c2y, r2)
%CIRC2: FINDS THE POINT OF INTERSECTION OF TWO CIRCLES

A = (-8*c2x*c1x-8*c1y*c2y+4*c1y^2+4*c2y^2+4*c1x^2+4*c2x^2);
B = (12*c2x^2*c1x^2*r2^2+12*c2x^2*c1x^2*r1^2+2*c1x^4*r1^2+2*c1x^4*r2^2-c1x^2*r1^4-...
    c1x^2*r2^4+2*c2x^4*r2^2-c2x^2*r1^4-c2x^2*r2^4+2*c1y^2*r2^2*c1x^2+...
    4*c1x^4*c2y*c1y+2*c1x^2*c2y^2*r2^2+8*c1x^3*c2y^2*c2x+2*c1y^2*r1^2*c1x^2+...
    12*c1y^2*c2y^2*c2x*c1x-8*c1y*c2y^3*c2x*c1x-4*r1^2*c2y*c1y*c2x^2-...
    4*r1^2*c2y*c1x^2*c1y-4*r1^2*c2y^2*c2x*c1x-8*c1y^3*c2x*c1x*c2y-...
    4*c2x^2*c2y*c1y*r2^2+24*c2x^2*c2y*c1x^2*c1y-16*c2x^3*c2y*c1x*c1y-...
    4*c1y*r2^2*c1x^2*c2y-4*c1y^2*r2^2*c2x*c1x-16*c1x^3*c2y*c2x*c1y-...
    4*c1y^2*r1^2*c2x*c1x+4*c1y*c2y^3*c2x^2-6*c1y^2*c2y^2*c2x^2+4*c1y*c2y^3*c1x^2-...
    6*c1y^2*c2y^2*c1x^2+2*c2x^2*r1^2*r2^2+2*c2x^4*r1^2+2*c1x^2*r1^2*r2^2-...
    4*c2x*c1x*r1^2*r2^2-4*c2y^2*r2^2*c2x*c1x-c1x^2*c2y^4-2*c1x^4*c1y^2+...
    20*c2x^3*c1x^3-15*c2x^2*c1x^4-15*c2x^4*c1x^2+6*c2x*c1x^5+6*c2x^5*c1x+...
    8*c1y*r2^2*c2x*c1x*c2y+8*c1x^3*c1y^2*c2x+2*c2x*c1x*c2y^4-8*c2x*c1x^3*r1^2-...
    8*c2x*c1x^3*r2^2-8*c2x^3*c1x*r1^2-8*c2x^3*c1x*r2^2+2*c2x*c1x*r1^4+...
    2*c2x*c1x*r2^4+2*r1^2*c2y^2*c2x^2+2*r1^2*c2y^2*c1x^2+8*r1^2*c2y*c2x*c1x*c1y+...
    4*c1y^3*c2x^2*c2y+4*c1y^3*c1x^2*c2y-c1y^4*c2x^2+2*c1y^4*c2x*c1x+...
    4*c2x^4*c2y*c1y-12*c2x^2*c2y^2*c1x^2+2*c2x^2*c2y^2*r2^2+8*c2x^3*c2y^2*c1x+...
    2*c1y^2*c2x^2*r2^2+2*c1y^2*c2x^2*r1^2-12*c1y^2*c2x^2*c1x^2+8*c1y^2*c2x^3*c1x-...
    c1x^6-c2x^6-c1y^4*c1x^2-2*c2x^4*c2y^2-c2x^2*c2y^4-2*c1y^2*c2x^4-2*c1x^4*c2y^2)^(1/2);

x = [ 1/2*(-1/A*(-4*c1y*c2y^2+4*r1^2*c2y+4*c1y^3+4*c2x^2*c2y+4*c1y*c2x^2+4*c1y*r2^2+...
        4*c1x^2*c2y-4*c1y*r1^2+4*c1x^2*c1y-4*c2y*r2^2-4*c1y^2*c2y-8*c2x*c1x*c1y-...
        8*c2x*c1x*c2y+4*c2y^3+4*B)*c1y+1/A*(-4*c1y*c2y^2+4*r1^2*c2y+4*c1y^3+...
        4*c2x^2*c2y+4*c1y*c2x^2+4*c1y*r2^2+4*c1x^2*c2y-4*c1y*r1^2+4*c1x^2*c1y-...
        4*c2y*r2^2-4*c1y^2*c2y-8*c2x*c1x*c1y-8*c2x*c1x*c2y+4*c2y^3+4*B)*c2y+c1x^2+...
        c1y^2-r1^2-c2x^2-c2y^2+r2^2)/(c1x-c2x),...
        1/2*(-1/A*(-4*c1y*c2y^2+4*r1^2*c2y+4*c1y^3+4*c2x^2*c2y+4*c1y*c2x^2+4*c1y*r2^2+...
        4*c1x^2*c2y-4*c1y*r1^2+4*c1x^2*c1y-4*c2y*r2^2-4*c1y^2*c2y-8*c2x*c1x*c1y-...
        8*c2x*c1x*c2y+4*c2y^3-4*B)*c1y+1/A*(-4*c1y*c2y^2+4*r1^2*c2y+4*c1y^3+...
        4*c2x^2*c2y+4*c1y*c2x^2+4*c1y*r2^2+4*c1x^2*c2y-4*c1y*r1^2+4*c1x^2*c1y-...
        4*c2y*r2^2-4*c1y^2*c2y-8*c2x*c1x*c1y-8*c2x*c1x*c2y+4*c2y^3-4*B)*c2y+c1x^2+...
        c1y^2-r1^2-c2x^2-c2y^2+r2^2)/(c1x-c2x)];

y = [ 1/2/A*(-4*c1y*c2y^2+4*r1^2*c2y+4*c1y^3+4*c2x^2*c2y+4*c1y*c2x^2+4*c1y*r2^2+...
        4*c1x^2*c2y-4*c1y*r1^2+4*c1x^2*c1y-4*c2y*r2^2-4*c1y^2*c2y-8*c2x*c1x*c1y-...
        8*c2x*c1x*c2y+4*c2y^3+4*B),...
        1/2/A*(-4*c1y*c2y^2+4*r1^2*c2y+4*c1y^3+4*c2x^2*c2y+4*c1y*c2x^2+4*c1y*r2^2+...
        4*c1x^2*c2y-4*c1y*r1^2+4*c1x^2*c1y-4*c2y*r2^2-4*c1y^2*c2y-8*c2x*c1x*c1y-...
        8*c2x*c1x*c2y+4*c2y^3-4*B)];



function [x, y] = lincirc(m, c, c1x, c1y, r1)
%LINCIRC: FINDS THE POINT OF INTERSECTION OF A CIRCLE AND A STRAIGHT LINE

int1 =2*(-2*m*c*c1x+2*c1y*m*c1x-c1y^2-c^2+2*c1y*c+r1^2-m^2*c1x^2+m^2*r1^2)^(1/2);
x=[ 1/2/(1+m^2)*(-2*m*c+2*c1y*m+2*c1x+int1),     1/2/(1+m^2)*(-2*m*c+2*c1y*m+2*c1x-int1)];
y=[ 1/2*m/(1+m^2)*(-2*m*c+2*c1y*m+2*c1x+int1)+c, 1/2*m/(1+m^2)*(-2*m*c+2*c1y*m+2*c1x-int1)+c];